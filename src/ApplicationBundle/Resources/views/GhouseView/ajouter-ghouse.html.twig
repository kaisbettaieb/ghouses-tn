<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>{% block title %}GuestHouses-TN | Ajouter Maison d'hote{% endblock %}</title>
    {% include '@Application/FrontView/header.html.twig' %}
    <style>

    </style>
</head>
<body id="bg-main">
{% include '@Application/FrontView/navbar.html.twig' %}
<main class="mt-5">
    <div class="container mb-5">
        <h3 class="text-center mb-4 my-5">Ajouter une maison</h3>
        {{ form_start(ghouse_add_form, {'attr' : {'id' : 'ghouse_add_form' } }) }}
        <div class="md-form">
            <i class="fa fa-home prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.nom, {'attr': { 'class' : 'form-control'} }) }}
            <label>Nom de la maison</label>
        </div>
        <div class="md-form">
            <i class="fa fa-user prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.nom_prenom_prop, {'attr': { 'class' : 'form-control' } }) }}
            <label>Nom et prenom du proprietaire</label>
        </div>
        <div class="md-form">
            <i class="fa fa-road prefix grey-text" aria-hidden="true"></i>
            {{ form_widget(ghouse_add_form.address, {'attr': { 'class' : 'form-control' } }) }}
            <label for="adresse">Adresse de la maison </label>
            <div id="map-container" class="z-depth-1-half map-container" style="height: 400px"></div>
        </div>
        <div class="md-form">
            <i class="fa fa-phone prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.homeNum, {'attr': { 'class' : 'form-control' } }) }}
            <label for="phone-fixe">Telephone fixe</label>
        </div>
        <div class="md-form">
            <i class="fa fa-mobile-phone prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.mobileNum, {'attr': { 'class' : 'form-control' } }) }}
            <label for="phone-portable">Telephone portable</label>
        </div>
        <div class="md-form">
            <i class="fa fa-pencil prefix grey-text "></i>
            {{ form_widget(ghouse_add_form.aPropos, {'attr': { 'class' : 'md-textarea', 'style' : 'height: 20px' } }) }}
            <label>A propos de la maison</label>
        </div>
        <div class="md-form">
            <i class="fa fa-cart-plus prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.options, {'attr': { 'class' : 'md-textarea',  'style' : 'height: 20px' } }) }}
            <label>Qu'est-ce que la maison offre, veuillez mettre chaque offre dans un ligne</label>
        </div>
        <div class="md-form">
            <i class="fa fa-pencil prefix grey-text "></i>
            {{ form_widget(ghouse_add_form.conditions, {'attr': { 'class' : 'md-textarea', 'style' : 'height: 20px' } }) }}
            <label for="condition-general">Condition géneral de la maisons</label>
        </div>
        <div class="md-form">
            <i class="fa fa-envelope prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.email, {'attr': { 'class' : 'form-control' } }) }}
            <label for="ght-email">Email</label>
        </div>
        <div class="md-form">
            <i class="fa fa-money prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.prixNuit, {'attr': { 'class' : 'form-control' } }) }}
            <label>Prix par nuit en DT</label>
        </div>
        <div class="md-form">
            <i class="fa fa-lock prefix grey-text"></i>
            {{ form_widget(ghouse_add_form.mots_cles, {'attr': { 'class' : 'md-textarea', 'style' : 'height: 20px' } }) }}
            <label>Les mots clés qui sont en relation avec votre maison, veuillez mettre des mots precis, veuillez
                mettre un mot dans chaque ligne </label>
        </div>
        <div class="md-form">
            {{ form_widget(ghouse_add_form.mapLat, {'attr': { 'style' : 'display:none' } }) }}
        </div>
        <div class="md-form">
            {{ form_widget(ghouse_add_form.mapLng, {'attr': { 'style' : 'display:none' } }) }}
        </div>
        <div class="md-form">
            <div class="row">
                <div class="col-md-4" id="container-image">
                </div>
                <div class="col-md-4">
                    {{ form_widget(ghouse_add_form.gh_images) }}
                </div>
            </div>

            <div class="text-center">
                <a href="#" id="add_image" class="btn btn-default btn-md">Joindre une photo</a>
            </div>
        </div>
        <div class="text-center">
            <button class="btn btn-deep-orange " type="submit" id="ajouter">Envoyer</button>
        </div>
        {{ form_end(ghouse_add_form) }}
        <style>
            .thumb {
                height: 75px;
                border: 1px solid #000;
                margin: 10px 5px 0 0;
            }
        </style>
        <input type="file" id="ghouse_images" name="ghouse_images[]" multiple/>
        <div id="images_preview" style="height:95px; border:1px solid #000;">
        </div>
    </div>
    </div>
</main>

{% include '@Application/FrontView/footer.html.twig' %}

<script type="text/javascript" src="{{ asset('assets/js/bootstrap-notify.js') }}"></script>
<script async defer
        src="https://maps.google.com/maps/api/js?key=AIzaSyBKjHhqdkrPFmPrEmbVYMwTVoq-ku_cUQI&callback=initMap"></script>
<script type="text/javascript" src="{{ asset('assets/js/ajouter-ghouse.js') }}"></script>

<script>
    $(document).ready(function () {

        var imagesCount = '{{ ghouse_add_form.gh_images|length }}';

        // On récupère la balise <div> en question qui contient l'attribut « data-prototype » qui nous intéresse.
        var $container = $('div#ghouse_form_gh_images');

        // On définit un compteur unique pour nommer les champs qu'on va ajouter dynamiquement
        var index = $container.find(':input').length;

        var $container_image;
        // On ajoute un nouveau champ à chaque clic sur le lien d'ajout.
        $('#add_image').click(function (e) {
            addImage($container);

            e.preventDefault(); // évite qu'un # apparaisse dans l'URL
            return false;
        });

        // On ajoute un premier champ automatiquement s'il n'en existe pas déjà un (cas d'une nouvelle annonce par exemple).
        if (index != 0) {
            $container.children('div').each(function () {
                addDeleteLink($(this));
            });
        }

        // La fonction qui ajoute un formulaire GhouseImages
        function addImage($container) {
            // Dans le contenu de l'attribut « data-prototype », on remplace :
            // - le texte "__name__label__" qu'il contient par le label du champ
            // - le texte "__name__" qu'il contient par le numéro du champ
            var template = $container.attr('data-prototype')
                .replace(/__name__label__/g, 'Image n°' + (index + 1))
                .replace(/__name__/g, index)
            ;

            // On crée un objet jquery qui contient ce template
            var $prototype = $(template);

            // On ajoute au prototype un lien pour pouvoir supprimer la catégorie
            addDeleteLink($prototype);

            // On ajoute le prototype modifié à la fin de la balise <div>
            $container.append($prototype);

            // Enfin, on incrémente le compteur pour que le prochain ajout se fasse avec un autre numéro
            index++;
        }

        // La fonction qui ajoute un lien de suppression d'une catégorie
        function addDeleteLink($prototype) {
            // Création du lien
            var $deleteLink = $('<a href="#" class="btn btn-danger btn-sm pull-right">X</a>');

            // Ajout du lien
            $prototype.append($deleteLink);

            // Ajout du listener sur le clic du lien pour effectivement supprimer la catégorie
            $deleteLink.click(function (e) {
                $prototype.remove();

                e.preventDefault(); // évite qu'un # apparaisse dans l'URL
                return false;
            });
        }
    });

</script>


{% if is_added == "Error" %}
    <script>
        $(document).ready(function () {
            {
                $.notify({
                    title: '<strong>Error</strong>',
                    message: 'Un probleme est subis lors de votre action, veuillez ressayer plus tard.'
                }, {
                    offset: {
                        x: 5,
                        y: 70
                    },
                    type: 'danger'
                });
            }


        });
    </script>
{% endif %}
{% if is_added == "Yes" %}
    <script>
        $(document).ready(function () {
            {
                $.notify({
                    title: '<strong>Success</strong>',
                    message: 'Votre maison a été ajouter, mais pour raisons de securité le maison doit etre vlider par un admin.'
                }, {
                    offset: {
                        x: 5,
                        y: 70
                    },
                    type: 'info'
                });
            }


        });
    </script>
{% endif %}
</body>

</html>
